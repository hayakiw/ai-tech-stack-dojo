<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API設計 - AI×Web開発 中級編 | AI Tech Stack</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%);
        }
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <!-- ヘッダー -->
    <header class="gradient-bg text-white shadow-lg">
        <nav class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <a href="index.html" class="text-2xl font-bold">AI Tech Stack Dojo <span class="text-blue-300">中級編</span></a>
                <div class="hidden md:flex space-x-6">
                    <a href="index.html" class="hover:text-blue-300">ホーム</a>
                    <a href="requirements.html" class="hover:text-blue-300 font-bold">設計</a>
                    <a href="docker-intro.html" class="hover:text-blue-300">Docker</a>
                    <a href="mysql-intro.html" class="hover:text-blue-300">MySQL</a>
                    <a href="auth-basics.html" class="hover:text-blue-300">認証</a>
                    <a href="blog-design.html" class="hover:text-blue-300">実践</a>
                </div>
            </div>
        </nav>
    </header>

    <!-- 進捗バー -->
    <div class="bg-white shadow">
        <div class="container mx-auto px-6 py-3">
            <div class="flex items-center justify-between text-sm">
                <span class="text-blue-600 font-bold">第1部：アプリケーション設計</span>
                <span class="text-gray-500">Step 3 / 24</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                <div class="bg-blue-600 h-2 rounded-full" style="width: 12%"></div>
            </div>
        </div>
    </div>

    <!-- メインコンテンツ -->
    <main class="container mx-auto px-6 py-12 max-w-4xl">
        <h1 class="text-4xl font-bold mb-8">API設計</h1>

        <!-- イントロ -->
        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-8">
            <p class="text-lg">REST APIは、フロントエンドとバックエンドをつなぐ重要なインターフェース。一貫性のある設計がアプリの品質を左右します。</p>
        </div>

        <!-- RESTful API基本 -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 pb-2 border-b-2 border-blue-200">RESTful API設計の基本</h2>

            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="font-bold mb-4">HTTPメソッドとCRUD</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-3 text-left">メソッド</th>
                                <th class="p-3 text-left">操作</th>
                                <th class="p-3 text-left">例</th>
                                <th class="p-3 text-left">説明</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b">
                                <td class="p-3"><span class="bg-green-100 text-green-700 px-2 py-1 rounded font-mono">GET</span></td>
                                <td class="p-3">Read（取得）</td>
                                <td class="p-3 font-mono text-xs">GET /posts</td>
                                <td class="p-3">記事一覧を取得</td>
                            </tr>
                            <tr class="border-b">
                                <td class="p-3"><span class="bg-blue-100 text-blue-700 px-2 py-1 rounded font-mono">POST</span></td>
                                <td class="p-3">Create（作成）</td>
                                <td class="p-3 font-mono text-xs">POST /posts</td>
                                <td class="p-3">新規記事を作成</td>
                            </tr>
                            <tr class="border-b">
                                <td class="p-3"><span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded font-mono">PUT</span></td>
                                <td class="p-3">Update（更新）</td>
                                <td class="p-3 font-mono text-xs">PUT /posts/1</td>
                                <td class="p-3">記事を全体更新</td>
                            </tr>
                            <tr class="border-b">
                                <td class="p-3"><span class="bg-orange-100 text-orange-700 px-2 py-1 rounded font-mono">PATCH</span></td>
                                <td class="p-3">Update（部分更新）</td>
                                <td class="p-3 font-mono text-xs">PATCH /posts/1</td>
                                <td class="p-3">記事を部分更新</td>
                            </tr>
                            <tr>
                                <td class="p-3"><span class="bg-red-100 text-red-700 px-2 py-1 rounded font-mono">DELETE</span></td>
                                <td class="p-3">Delete（削除）</td>
                                <td class="p-3 font-mono text-xs">DELETE /posts/1</td>
                                <td class="p-3">記事を削除</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="font-bold mb-4">URL設計のルール</h3>
                <div class="space-y-3">
                    <div class="flex items-center p-3 bg-green-50 rounded">
                        <span class="text-green-600 mr-3">○</span>
                        <span class="font-mono text-sm">/posts</span>
                        <span class="text-gray-500 ml-3">複数形の名詞を使う</span>
                    </div>
                    <div class="flex items-center p-3 bg-red-50 rounded">
                        <span class="text-red-600 mr-3">✗</span>
                        <span class="font-mono text-sm">/getPost, /createPost</span>
                        <span class="text-gray-500 ml-3">動詞は使わない</span>
                    </div>
                    <div class="flex items-center p-3 bg-green-50 rounded">
                        <span class="text-green-600 mr-3">○</span>
                        <span class="font-mono text-sm">/posts/1/comments</span>
                        <span class="text-gray-500 ml-3">関連リソースは階層で表現</span>
                    </div>
                    <div class="flex items-center p-3 bg-green-50 rounded">
                        <span class="text-green-600 mr-3">○</span>
                        <span class="font-mono text-sm">/posts?page=1&limit=10</span>
                        <span class="text-gray-500 ml-3">フィルタ・ページングはクエリパラメータ</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- ブログアプリAPI設計 -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 pb-2 border-b-2 border-blue-200">ブログアプリのAPI設計</h2>

            <div class="space-y-6">
                <!-- 認証API -->
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold mb-4 text-purple-600">認証API</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-purple-50">
                                <tr>
                                    <th class="p-3 text-left">エンドポイント</th>
                                    <th class="p-3 text-left">説明</th>
                                    <th class="p-3 text-left">認証</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b">
                                    <td class="p-3 font-mono text-xs">POST /auth/register</td>
                                    <td class="p-3">ユーザー新規登録</td>
                                    <td class="p-3"><span class="text-gray-400">不要</span></td>
                                </tr>
                                <tr class="border-b">
                                    <td class="p-3 font-mono text-xs">POST /auth/login</td>
                                    <td class="p-3">ログイン（トークン発行）</td>
                                    <td class="p-3"><span class="text-gray-400">不要</span></td>
                                </tr>
                                <tr>
                                    <td class="p-3 font-mono text-xs">GET /auth/me</td>
                                    <td class="p-3">現在のユーザー情報</td>
                                    <td class="p-3"><span class="text-green-600 font-bold">必要</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 記事API -->
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold mb-4 text-blue-600">記事API</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-blue-50">
                                <tr>
                                    <th class="p-3 text-left">エンドポイント</th>
                                    <th class="p-3 text-left">説明</th>
                                    <th class="p-3 text-left">認証</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="border-b">
                                    <td class="p-3 font-mono text-xs">GET /posts</td>
                                    <td class="p-3">記事一覧取得</td>
                                    <td class="p-3"><span class="text-gray-400">不要</span></td>
                                </tr>
                                <tr class="border-b">
                                    <td class="p-3 font-mono text-xs">GET /posts/:id</td>
                                    <td class="p-3">記事詳細取得</td>
                                    <td class="p-3"><span class="text-gray-400">不要</span></td>
                                </tr>
                                <tr class="border-b">
                                    <td class="p-3 font-mono text-xs">POST /posts</td>
                                    <td class="p-3">記事作成</td>
                                    <td class="p-3"><span class="text-green-600 font-bold">必要</span></td>
                                </tr>
                                <tr class="border-b">
                                    <td class="p-3 font-mono text-xs">PUT /posts/:id</td>
                                    <td class="p-3">記事更新</td>
                                    <td class="p-3"><span class="text-green-600 font-bold">必要（本人のみ）</span></td>
                                </tr>
                                <tr>
                                    <td class="p-3 font-mono text-xs">DELETE /posts/:id</td>
                                    <td class="p-3">記事削除</td>
                                    <td class="p-3"><span class="text-green-600 font-bold">必要（本人のみ）</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- リクエスト/レスポンス -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 pb-2 border-b-2 border-blue-200">リクエストとレスポンスの例</h2>

            <div class="space-y-6">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold mb-3">POST /auth/register - ユーザー登録</h3>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm font-bold text-gray-600 mb-2">リクエスト</p>
                            <div class="code-block p-4 rounded font-mono text-xs overflow-x-auto">
<pre>{
  "email": "user@example.com",
  "password": "securepassword",
  "name": "山田太郎"
}</pre>
                            </div>
                        </div>
                        <div>
                            <p class="text-sm font-bold text-gray-600 mb-2">レスポンス（201 Created）</p>
                            <div class="code-block p-4 rounded font-mono text-xs overflow-x-auto">
<pre>{
  "id": 1,
  "email": "user@example.com",
  "name": "山田太郎",
  "createdAt": "2024-01-15T10:30:00Z"
}</pre>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold mb-3">POST /auth/login - ログイン</h3>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm font-bold text-gray-600 mb-2">リクエスト</p>
                            <div class="code-block p-4 rounded font-mono text-xs overflow-x-auto">
<pre>{
  "email": "user@example.com",
  "password": "securepassword"
}</pre>
                            </div>
                        </div>
                        <div>
                            <p class="text-sm font-bold text-gray-600 mb-2">レスポンス（200 OK）</p>
                            <div class="code-block p-4 rounded font-mono text-xs overflow-x-auto">
<pre>{
  "access_token": "eyJhbGciOiJ...",
  "token_type": "bearer"
}</pre>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold mb-3">GET /posts - 記事一覧</h3>
                    <p class="text-sm font-bold text-gray-600 mb-2">レスポンス（200 OK）</p>
                    <div class="code-block p-4 rounded font-mono text-xs overflow-x-auto">
<pre>{
  "posts": [
    {
      "id": 1,
      "title": "はじめての投稿",
      "content": "これは最初の記事です...",
      "author": {
        "id": 1,
        "name": "山田太郎"
      },
      "createdAt": "2024-01-15T10:30:00Z",
      "updatedAt": "2024-01-15T10:30:00Z"
    }
  ],
  "total": 1,
  "page": 1,
  "limit": 10
}</pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- HTTPステータスコード -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 pb-2 border-b-2 border-blue-200">HTTPステータスコード</h2>

            <div class="bg-white p-6 rounded-lg shadow">
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-bold mb-3 text-green-600">成功（2xx）</h3>
                        <ul class="space-y-2 text-sm">
                            <li><span class="font-mono bg-green-100 px-2 py-1 rounded">200</span> OK - 成功</li>
                            <li><span class="font-mono bg-green-100 px-2 py-1 rounded">201</span> Created - 作成成功</li>
                            <li><span class="font-mono bg-green-100 px-2 py-1 rounded">204</span> No Content - 削除成功</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-bold mb-3 text-red-600">エラー（4xx, 5xx）</h3>
                        <ul class="space-y-2 text-sm">
                            <li><span class="font-mono bg-red-100 px-2 py-1 rounded">400</span> Bad Request - リクエスト不正</li>
                            <li><span class="font-mono bg-red-100 px-2 py-1 rounded">401</span> Unauthorized - 認証必要</li>
                            <li><span class="font-mono bg-red-100 px-2 py-1 rounded">403</span> Forbidden - 権限なし</li>
                            <li><span class="font-mono bg-red-100 px-2 py-1 rounded">404</span> Not Found - 見つからない</li>
                            <li><span class="font-mono bg-red-100 px-2 py-1 rounded">500</span> Internal Error - サーバーエラー</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- FastAPIでの実装 -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 pb-2 border-b-2 border-blue-200">FastAPIでの実装例</h2>

            <div class="bg-white p-6 rounded-lg shadow">
                <div class="code-block p-4 rounded font-mono text-sm overflow-x-auto">
<pre>from fastapi import FastAPI, HTTPException, Depends
from pydantic import BaseModel

app = FastAPI()

# リクエスト/レスポンスの型定義
class PostCreate(BaseModel):
    title: str
    content: str

class PostResponse(BaseModel):
    id: int
    title: str
    content: str
    author_id: int
    created_at: datetime

# 記事一覧
@app.get("/posts", response_model=list[PostResponse])
def get_posts(page: int = 1, limit: int = 10):
    # データベースから記事を取得
    return posts

# 記事詳細
@app.get("/posts/{post_id}", response_model=PostResponse)
def get_post(post_id: int):
    post = get_post_by_id(post_id)
    if not post:
        raise HTTPException(status_code=404, detail="Post not found")
    return post

# 記事作成（認証必要）
@app.post("/posts", response_model=PostResponse, status_code=201)
def create_post(post: PostCreate, current_user = Depends(get_current_user)):
    new_post = create_post_in_db(post, current_user.id)
    return new_post

# 記事削除（本人のみ）
@app.delete("/posts/{post_id}", status_code=204)
def delete_post(post_id: int, current_user = Depends(get_current_user)):
    post = get_post_by_id(post_id)
    if not post:
        raise HTTPException(status_code=404, detail="Post not found")
    if post.author_id != current_user.id:
        raise HTTPException(status_code=403, detail="Not authorized")
    delete_post_from_db(post_id)
    return None</pre>
                </div>
            </div>
        </section>

        <!-- まとめ -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 pb-2 border-b-2 border-blue-200">まとめ</h2>
            <div class="bg-blue-50 p-6 rounded-lg">
                <ul class="space-y-3">
                    <li class="flex items-start">
                        <span class="text-blue-600 mr-2">✓</span>
                        <span>HTTPメソッドを適切に使い分ける（GET, POST, PUT, DELETE）</span>
                    </li>
                    <li class="flex items-start">
                        <span class="text-blue-600 mr-2">✓</span>
                        <span>URLは複数形の名詞を使う（/posts, /users）</span>
                    </li>
                    <li class="flex items-start">
                        <span class="text-blue-600 mr-2">✓</span>
                        <span>適切なステータスコードを返す</span>
                    </li>
                    <li class="flex items-start">
                        <span class="text-blue-600 mr-2">✓</span>
                        <span>認証が必要なエンドポイントを明確にする</span>
                    </li>
                </ul>
            </div>
        </section>

        <!-- ナビゲーション -->
        <div class="flex justify-between items-center pt-8 border-t">
            <a href="component-design.html" class="flex items-center text-gray-600 hover:text-blue-600">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                コンポーネント設計
            </a>
            <a href="database-design.html" class="flex items-center bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700">
                次へ：データベース設計
                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
        </div>
    </main>

    <!-- フッター -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-6 text-center">
            <p class="text-gray-400">AI×Web開発 中級編</p>
        </div>
    </footer>
</body>
</html>
