<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>クリーンアーキテクチャをAIと実装 - AI駆動開発 上級編 | AI Tech Stack</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #dc2626 0%, #ea580c 50%, #f59e0b 100%);
        }
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
        }
        .prompt-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid #f59e0b;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <!-- ヘッダー -->
    <header class="gradient-bg text-white shadow-lg">
        <nav class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <a href="index.html" class="text-2xl font-bold">AI Tech Stack Dojo <span class="text-yellow-200">上級編</span></a>
                <div class="hidden md:flex space-x-6">
                    <a href="index.html" class="hover:text-yellow-200">ホーム</a>
                    <a href="ai-large-project.html" class="hover:text-yellow-200">AI深化</a>
                    <a href="ai-architecture.html" class="hover:text-yellow-200 font-bold">設計</a>
                    <a href="ai-testing.html" class="hover:text-yellow-200">テスト</a>
                    <a href="mcp-intro.html" class="hover:text-yellow-200">MCP</a>
                    <a href="project-design.html" class="hover:text-yellow-200">実践</a>
                </div>
            </div>
        </nav>
    </header>

    <!-- 進捗バー -->
    <div class="bg-white shadow">
        <div class="container mx-auto px-6 py-3">
            <div class="flex items-center justify-between text-sm">
                <span class="text-orange-600 font-bold">第2部：AIとアーキテクチャ設計</span>
                <span class="text-gray-500">Step 6 / 36</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                <div class="bg-orange-500 h-2 rounded-full" style="width: 17%"></div>
            </div>
        </div>
    </div>

    <!-- メインコンテンツ -->
    <main class="container mx-auto px-6 py-12 max-w-4xl">
        <h1 class="text-4xl font-bold mb-8">クリーンアーキテクチャをAIと実装</h1>

        <!-- イントロ -->
        <div class="bg-orange-50 border-l-4 border-orange-500 p-6 mb-8">
            <p class="text-lg">クリーンアーキテクチャは複雑に見えますが、AIと一緒に進めれば効率的に実装できます。レイヤーごとに役割を理解し、段階的に構築していきましょう。</p>
        </div>

        <!-- クリーンアーキテクチャとは -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 pb-2 border-b-2 border-orange-200">クリーンアーキテクチャの基本</h2>

            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="font-bold mb-4">レイヤー構成</h3>
                <div class="space-y-3">
                    <div class="p-4 bg-blue-100 rounded-lg">
                        <h4 class="font-bold text-blue-800">Entities（エンティティ）</h4>
                        <p class="text-sm">ビジネスルールを表現。最も内側で、他に依存しない</p>
                    </div>
                    <div class="p-4 bg-green-100 rounded-lg">
                        <h4 class="font-bold text-green-800">Use Cases（ユースケース）</h4>
                        <p class="text-sm">アプリケーション固有のビジネスロジック</p>
                    </div>
                    <div class="p-4 bg-yellow-100 rounded-lg">
                        <h4 class="font-bold text-yellow-800">Interface Adapters（インターフェースアダプター）</h4>
                        <p class="text-sm">コントローラー、プレゼンター、ゲートウェイ</p>
                    </div>
                    <div class="p-4 bg-red-100 rounded-lg">
                        <h4 class="font-bold text-red-800">Frameworks & Drivers（フレームワーク）</h4>
                        <p class="text-sm">DB、Web、外部サービスなど。最も外側</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="font-bold mb-3">依存関係のルール</h3>
                <p class="text-sm text-gray-600 mb-4">内側のレイヤーは外側のレイヤーを知らない。依存は常に外から内へ向かう。</p>
                <div class="text-center text-2xl">
                    外側 → → → 内側<br>
                    <span class="text-sm text-gray-500">DB → Repository → Service → Entity</span>
                </div>
            </div>
        </section>

        <!-- FastAPIでの実装 -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 pb-2 border-b-2 border-orange-200">FastAPIでの実装例</h2>

            <div class="prompt-box p-4 rounded mb-6">
                <h4 class="font-bold mb-2">AIへの指示：プロジェクト構造の作成</h4>
                <div class="code-block p-4 rounded font-mono text-sm overflow-x-auto">
<pre>FastAPIでクリーンアーキテクチャを採用したプロジェクト構造を作成してください。

【機能】
タスク管理システム（CRUD）

【要件】
- ドメイン層：Task エンティティ
- ユースケース層：タスクの作成、取得、更新、削除
- インフラ層：SQLAlchemy を使用したリポジトリ
- プレゼンテーション層：FastAPI エンドポイント

まず、フォルダ構造と各ファイルの役割を説明してください。</pre>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="font-bold mb-3">推奨フォルダ構造</h3>
                <div class="code-block p-4 rounded font-mono text-sm overflow-x-auto">
<pre>app/
├── main.py                    # FastAPIアプリ起動
├── domain/                    # ドメイン層
│   ├── entities/
│   │   └── task.py           # Taskエンティティ
│   └── repositories/
│       └── task_repository.py # リポジトリインターフェース（抽象）
├── application/               # ユースケース層
│   └── use_cases/
│       └── task_use_cases.py # ビジネスロジック
├── infrastructure/            # インフラ層
│   ├── database/
│   │   ├── connection.py     # DB接続
│   │   └── models.py         # SQLAlchemyモデル
│   └── repositories/
│       └── task_repository_impl.py  # リポジトリ実装
└── presentation/              # プレゼンテーション層
    ├── api/
    │   └── tasks.py          # エンドポイント
    └── schemas/
        └── task_schema.py    # リクエスト/レスポンス</pre>
                </div>
            </div>
        </section>

        <!-- 段階的な実装 -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 pb-2 border-b-2 border-orange-200">AIと段階的に実装する</h2>

            <div class="space-y-6">
                <!-- Step 1 -->
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold text-lg mb-3 flex items-center">
                        <span class="bg-orange-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3">1</span>
                        ドメインエンティティを作成
                    </h3>
                    <div class="prompt-box p-3 rounded mb-3">
                        <div class="code-block p-3 rounded font-mono text-xs overflow-x-auto">
<pre>「domain/entities/task.py を作成してください。
Task エンティティには id, title, description, status, created_at, updated_at を含めます。
ビジネスルールとして、status は "todo", "in_progress", "done" のいずれかです。
フレームワークに依存しない純粋なPythonクラスで実装してください。」</pre>
                        </div>
                    </div>
                    <div class="code-block p-3 rounded font-mono text-xs overflow-x-auto">
<pre class="text-green-400"># domain/entities/task.py
from dataclasses import dataclass
from datetime import datetime
from enum import Enum

class TaskStatus(Enum):
    TODO = "todo"
    IN_PROGRESS = "in_progress"
    DONE = "done"

@dataclass
class Task:
    id: str
    title: str
    description: str
    status: TaskStatus
    created_at: datetime
    updated_at: datetime

    def mark_as_done(self) -> None:
        self.status = TaskStatus.DONE
        self.updated_at = datetime.now()</pre>
                    </div>
                </div>

                <!-- Step 2 -->
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold text-lg mb-3 flex items-center">
                        <span class="bg-orange-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3">2</span>
                        リポジトリインターフェースを定義
                    </h3>
                    <div class="prompt-box p-3 rounded mb-3">
                        <div class="code-block p-3 rounded font-mono text-xs overflow-x-auto">
<pre>「domain/repositories/task_repository.py を作成してください。
TaskRepository の抽象基底クラス（ABC）を定義し、
save, find_by_id, find_all, delete メソッドを宣言してください。
この時点ではDBに依存しません。」</pre>
                        </div>
                    </div>
                    <div class="code-block p-3 rounded font-mono text-xs overflow-x-auto">
<pre class="text-green-400"># domain/repositories/task_repository.py
from abc import ABC, abstractmethod
from typing import Optional, List
from domain.entities.task import Task

class TaskRepository(ABC):
    @abstractmethod
    def save(self, task: Task) -> Task:
        pass

    @abstractmethod
    def find_by_id(self, task_id: str) -> Optional[Task]:
        pass

    @abstractmethod
    def find_all(self) -> List[Task]:
        pass

    @abstractmethod
    def delete(self, task_id: str) -> None:
        pass</pre>
                    </div>
                </div>

                <!-- Step 3 -->
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold text-lg mb-3 flex items-center">
                        <span class="bg-orange-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3">3</span>
                        ユースケースを実装
                    </h3>
                    <div class="prompt-box p-3 rounded mb-3">
                        <div class="code-block p-3 rounded font-mono text-xs overflow-x-auto">
<pre>「application/use_cases/task_use_cases.py を作成してください。
TaskRepository をコンストラクタで受け取り（依存性注入）、
CreateTask, GetTask, UpdateTask, DeleteTask のユースケースを実装してください。」</pre>
                        </div>
                    </div>
                </div>

                <!-- Step 4 -->
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold text-lg mb-3 flex items-center">
                        <span class="bg-orange-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3">4</span>
                        インフラ層（リポジトリ実装）
                    </h3>
                    <div class="prompt-box p-3 rounded mb-3">
                        <div class="code-block p-3 rounded font-mono text-xs overflow-x-auto">
<pre>「infrastructure/repositories/task_repository_impl.py を作成してください。
TaskRepository インターフェースを実装し、SQLAlchemy を使ってDBアクセスします。
エンティティとDBモデルの変換も行ってください。」</pre>
                        </div>
                    </div>
                </div>

                <!-- Step 5 -->
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold text-lg mb-3 flex items-center">
                        <span class="bg-orange-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3">5</span>
                        プレゼンテーション層（API）
                    </h3>
                    <div class="prompt-box p-3 rounded mb-3">
                        <div class="code-block p-3 rounded font-mono text-xs overflow-x-auto">
<pre>「presentation/api/tasks.py を作成してください。
FastAPI の Router を使い、CRUD エンドポイントを実装します。
ユースケースを依存性注入で受け取り、Pydanticスキーマで入出力を定義してください。」</pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 依存性注入の設定 -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 pb-2 border-b-2 border-orange-200">依存性注入の設定</h2>

            <div class="prompt-box p-4 rounded mb-6">
                <h4 class="font-bold mb-2">AIへの指示</h4>
                <div class="code-block p-4 rounded font-mono text-sm overflow-x-auto">
<pre>「FastAPI の Depends を使って依存性注入を設定してください。
- TaskRepository の実装を TaskRepositoryImpl に差し替え可能にする
- テスト時にモックリポジトリを注入できるようにする
- main.py でのワイヤリング方法を示してください」</pre>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="font-bold mb-3">依存性注入のコード例</h3>
                <div class="code-block p-4 rounded font-mono text-sm overflow-x-auto">
<pre class="text-green-400"># main.py
from fastapi import FastAPI, Depends
from infrastructure.repositories.task_repository_impl import TaskRepositoryImpl
from application.use_cases.task_use_cases import TaskUseCases
from presentation.api.tasks import router

app = FastAPI()

def get_task_repository():
    return TaskRepositoryImpl()

def get_task_use_cases(repo = Depends(get_task_repository)):
    return TaskUseCases(repo)

app.include_router(router)</pre>
                </div>
            </div>
        </section>

        <!-- メリットと注意点 -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 pb-2 border-b-2 border-orange-200">クリーンアーキテクチャのメリット</h2>

            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold text-green-600 mb-3">メリット</h3>
                    <ul class="text-sm space-y-2">
                        <li>✓ テストが書きやすい（モック注入可能）</li>
                        <li>✓ フレームワークの変更に強い</li>
                        <li>✓ ビジネスロジックが明確に分離</li>
                        <li>✓ チーム開発で責任範囲が明確</li>
                    </ul>
                </div>
                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="font-bold text-yellow-600 mb-3">注意点</h3>
                    <ul class="text-sm space-y-2">
                        <li>△ 小規模プロジェクトには過剰かも</li>
                        <li>△ ファイル数が増える</li>
                        <li>△ 学習コストがある</li>
                        <li>△ シンプルなCRUDには向かない場合も</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- まとめ -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 pb-2 border-b-2 border-orange-200">まとめ</h2>
            <div class="bg-orange-50 p-6 rounded-lg">
                <ul class="space-y-3">
                    <li class="flex items-start">
                        <span class="text-orange-600 mr-2">✓</span>
                        <span><strong>レイヤーを理解する</strong> - エンティティ→ユースケース→アダプター→フレームワーク</span>
                    </li>
                    <li class="flex items-start">
                        <span class="text-orange-600 mr-2">✓</span>
                        <span><strong>内側から外側へ実装</strong> - エンティティ→リポジトリIF→ユースケース→実装</span>
                    </li>
                    <li class="flex items-start">
                        <span class="text-orange-600 mr-2">✓</span>
                        <span><strong>依存性注入を活用</strong> - テスト容易性と柔軟性を確保</span>
                    </li>
                    <li class="flex items-start">
                        <span class="text-orange-600 mr-2">✓</span>
                        <span><strong>AIに段階的に依頼</strong> - レイヤーごとに指示を出す</span>
                    </li>
                </ul>
            </div>
        </section>

        <!-- ナビゲーション -->
        <div class="flex justify-between items-center pt-8 border-t">
            <a href="ai-architecture.html" class="flex items-center text-gray-600 hover:text-orange-600">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                AIに設計を相談する
            </a>
            <a href="ai-refactoring.html" class="flex items-center bg-orange-500 text-white px-6 py-3 rounded-lg hover:bg-orange-600">
                次へ：既存コードのリファクタリング
                <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
        </div>
    </main>

    <!-- フッター -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-6 text-center">
            <p class="text-gray-400">AI駆動開発 上級編</p>
        </div>
    </footer>
</body>
</html>
